<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª + Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Firebase</title>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-messaging-compat.js"></script>

<style>
body{
  background:#111;
  color:#fff;
  font-family:Arial;
  text-align:center;
  padding:40px;
}
input{
  padding:12px;
  margin:8px;
  border-radius:10px;
  border:none;
  width:260px;
}
button{
  padding:12px 30px;
  margin:6px;
  border:none;
  border-radius:10px;
  background:#00c853;
  color:#fff;
  cursor:pointer;
  font-size:16px;
}
#adminPanel{
  display:none;
  margin-top:25px;
  padding:20px;
  background:#000;
  border-radius:15px;
}
#log{
  margin-top:20px;
  background:#000;
  padding:15px;
  border-radius:12px;
  text-align:left;
  white-space:pre-line;
}
</style>
</head>
<body>

<h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
<input id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯"><br>
<input id="pass" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"><br>
<button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
<button id="signupBtn">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>

<hr>

<div id="orderBox" style="display:none">
<h2>Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨</h2>
<input id="order" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ù„Ø¨"><br>
<button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„</button>
<button id="testNotifBtn">Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø´Ø¹Ø§Ø±</button>
</div>

<div id="adminPanel">
<h3>ðŸ‘‘ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</h3>
<div id="adminInfo"></div>
</div>

<div id="log">Logs:\n</div>

<script>
function log(t){
  document.getElementById("log").innerHTML+=t+"\n";
}

/* Firebase Config */
const firebaseConfig={
  apiKey:"AIzaSyDPcyxpHRuLx9T2CO4LJ-n9jaqAynUjvqw",
  authDomain:"xix5-a119a.firebaseapp.com",
  projectId:"xix5-a119a",
  messagingSenderId:"332265425367",
  appId:"1:332265425367:web:0a95e71d8bd0058503a392"
};
firebase.initializeApp(firebaseConfig);

const auth=firebase.auth();
const db=firebase.firestore();
const messaging=firebase.messaging();

const ADMIN_EMAIL="uusu.06@gmail.com";

/* ØªØ³Ø¬ÙŠÙ„ SW */
navigator.serviceWorker.register("firebase-messaging-sw.js");

/* ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  try{
    const userCredential = await auth.signInWithEmailAndPassword(
      document.getElementById("email").value,
      document.getElementById("pass").value
    );
    log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: "+userCredential.user.email);
  } catch(e){
    log("Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: "+e.message);
    alert("Ø®Ø·Ø£ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„: "+e.message);
  }
});

/* Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ */
document.getElementById("signupBtn").addEventListener("click", async ()=>{
  try{
    const userCredential = await auth.createUserWithEmailAndPassword(
      document.getElementById("email").value,
      document.getElementById("pass").value
    );
    log("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: "+userCredential.user.email);
    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­!");
  } catch(e){
    log("Ø®Ø·Ø£ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: "+e.message);
    alert("Ø®Ø·Ø£ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: "+e.message);
  }
});

/* Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ */
document.getElementById("sendBtn").addEventListener("click", async ()=>{
  const user = auth.currentUser;
  if(!user){
    alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!");
    return;
  }
  await db.collection("orders").add({
    name: document.getElementById("order").value,
    user: user.email,
    time: new Date().toLocaleString()
  });
  log("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨: "+document.getElementById("order").value);
});

/* Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ */
document.getElementById("testNotifBtn").addEventListener("click", async ()=>{
  const user = auth.currentUser;
  if(!user) return alert("ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„!");
  const adminDoc = await db.collection("admins").doc(user.uid).get();
  const token = adminDoc.data().token;
  if(!token) return alert("Ù„Ù… ÙŠØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªÙˆÙƒÙ† Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¨Ø¹Ø¯");

  /* Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¨Ø§Ø´Ø± Ø¨Ø¯ÙˆÙ† Server Key */
  new Notification("Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ", {body:"Ø¥Ø°Ø§ Ø¸Ù‡Ø± Ù‡Ø°Ø§ â†’ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„ âœ…"});
  log("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ØªØ¬Ø±ÙŠØ¨ÙŠ Ù…Ø¨Ø§Ø´Ø±");
});

/* Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… */
auth.onAuthStateChanged(async user=>{
  if(!user){
    orderBox.style.display="none";
    adminPanel.style.display="none";
    return;
  }

  orderBox.style.display="block";
  log("Ù…Ø³ØªØ®Ø¯Ù…: "+user.email);

  if(user.email===ADMIN_EMAIL){
    adminPanel.style.display="block";
    adminInfo.innerHTML="Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„";

    await Notification.requestPermission();
    const reg = await navigator.serviceWorker.ready;

    const token = await messaging.getToken({
      vapidKey:"BEIkmsbcatAy4Kq8_ehZE19KzKQx2pHaYvIKmgTEq1oFSmePLEG7faBAsibGl1mFCNDbFv9-znm2x4DzpDISS8o",
      serviceWorkerRegistration: reg
    });

    await db.collection("admins").doc(user.uid).set({
      email: user.email,
      token: token
    });

    log("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª: "+token);
  } else {
    adminPanel.style.display="none";
  }
});

/* Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø£Ø«Ù†Ø§Ø¡ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© */
messaging.onMessage(payload=>{
  log("Ø¥Ø´Ø¹Ø§Ø±: "+payload.notification.title);
});
</script>

</body>
</html>
